<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Item Details | Back2U</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background-color: #f9f9f9; }
    body.dark-mode { background-color: #121212 !important; color: #e0e0e0 !important; }
    .navbar { background: linear-gradient(to right, #6a11cb, #2575fc); }
    .navbar a { color: white !important; }
    .dark-mode .navbar { background: linear-gradient(to right, #333, #555); }
    .item-image {
      max-width: 300px; max-height: 250px; object-fit: contain;
      border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg px-4">
  <a class="navbar-brand fw-bold text-white" href="{{ url_for('dashboard') }}">Back2U</a>
  <div class="ms-auto d-flex align-items-center gap-2">
    <button type="button" onclick="goBack()" class="btn btn-light btn-sm rounded-pill">â¬… Back</button>
    <button onclick="toggleDarkMode()" class="btn btn-outline-light btn-sm rounded-pill">ðŸŒ™</button>
    {% if current_user.is_authenticated %}
      <span class="text-white ms-2">Hi, {{ current_user.name }}</span>
      <a href="{{ url_for('logout') }}" class="btn btn-light btn-sm rounded-pill">Logout</a>
    {% endif %}
  </div>
</nav>

<!-- Item Details -->
<div class="container mt-5">
  <div class="card p-4 shadow-lg">
    <h2 class="fw-bold mb-3">{{ item.title }}</h2>

    {% if item.image %}
      <img src="{{ url_for('static', filename='images/' ~ item.image) }}" alt="Item Image" class="item-image mb-3">
    {% else %}
      <p class="text-muted"><i>No image uploaded</i></p>
    {% endif %}

    <p><strong>Type:</strong> {{ item.type }}</p>
    <p><strong>Location:</strong> {{ item.location }}</p>
    <p><strong>Description:</strong> {{ item.description }}</p>
    <p><strong>Reported on:</strong> {{ item.date_reported.strftime('%d-%m-%Y %I:%M %p') }}</p>
    <p>
      <strong>Status:</strong>
      <span class="badge {% if item.is_resolved %}bg-success{% else %}bg-warning{% endif %}">
        {{ 'Resolved' if item.is_resolved else 'Pending' }}
      </span>
    </p>

    <hr>

    <!-- Reporter / Owner Section -->
    {% if current_user.id == item.user_id %}
      <h5 class="mt-3">ðŸ‘¤ You are the reporter</h5>
      <div class="d-flex gap-2 mt-2">
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">â¬… Back</a>
        <form method="post" action="{{ url_for('delete_item', item_id=item.id) }}" onsubmit="return confirm('Delete this item?');">
          <button type="submit" class="btn btn-danger">ðŸ—‘ Delete</button>
        </form>
        <form method="post" action="{{ url_for('update_status', item_id=item.id) }}">
          <button type="submit" class="btn {% if item.is_resolved %}btn-warning{% else %}btn-success{% endif %}">
            {% if item.is_resolved %}Mark Pending{% else %}Mark Resolved{% endif %}
          </button>
        </form>
      </div>
    {% else %}
      <!-- Non-owner: Contact Reporter -->
      <h5 class="mt-3">ðŸ“© Contact Reporter</h5>
      <p><strong>Name:</strong> {{ item.user.name }}</p>
      <p><strong>Email:</strong> {{ item.user.email }}</p>

      {% set status_text = "Resolved" if item.is_resolved else "Pending" %}

      <a href="mailto:{{ item.user.email }}?subject=Regarding%20your%20{{ item.type }}%20item:%20{{ item.title }}&body=Hello%20{{ item.user.name }},%0D%0A%0D%0AI%20am%20contacting%20you%20regarding%20the%20item%20you%20reported.%0D%0A%0D%0ADescription:%20{{ item.description }}%0D%0ALocation:%20{{ item.location }}%0D%0AStatus:%20{{ status_text }}%0D%0AReported%20on:%20{{ item.date_reported.strftime('%d-%m-%Y %I:%M %p') }}%0D%0A%0D%0AThank%20you."
         class="btn btn-primary">
        âœ‰ Send Email
      </a>
    {% endif %}
  </div>
</div>

<!-- Scripts -->
<script>
  function toggleDarkMode() {
    document.body.classList.toggle("dark-mode");
    if (document.body.classList.contains("dark-mode")) {
      localStorage.setItem("darkMode", "enabled");
    } else {
      localStorage.setItem("darkMode", "disabled");
    }
  }
  window.onload = function() {
    if (localStorage.getItem("darkMode") === "enabled") {
      document.body.classList.add("dark-mode");
    }
  }
  function goBack() {
    if (document.referrer && document.referrer !== window.location.href) {
      history.back();
    } else {
      window.location.href = "{{ url_for('dashboard') }}";
    }
  }
</script>
</body>
</html>
